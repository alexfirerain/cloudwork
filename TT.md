# Дипломная работа «Облачное хранилище»

## Задача
Разработать REST-сервис, предоставляющий REST-интерфейс для загрузки файлов и вывода списка уже загруженных файлов пользователя. Все запросы к сервису должны быть авторизованы. Заранее подготовленное веб-приложение ([FRONT](https://github.com/netology-code/jd-homeworks/tree/master/diploma/netology-diplom-frontend)) должно подключаться к разработанному сервису без доработок, а также использовать функционал FRONT для авторизации, загрузки и вывода списка файлов пользователя.

## Требования 

- Сервис должен предоставлять REST-интерфейс для интеграции с FRONT.
- Сервис должен реализовывать все методы, описанные в [yaml-файле](./CloudServiceSpecification.yaml):
    * Авторизация (логин и логаут).
    * Вывод списка файлов.
    * Добавление файла.
    * Удаление файла.
    * Скачивание файла.
    * Переименование файла.
- Все настройки должны вычитываться из файла настроек (yml).
- Информация о пользователях сервиса (логины для авторизации) и данные должны храниться в базе данных (на выбор).

## Требования к реализации

- Приложение разработано с использованием Spring Boot.
- Использован сборщик пакетов gradle/maven.
- Для запуска используется docker, docker-compose.
- Код размещён на Github.
- Код покрыт unit-тестами с использованием mockito.
- Добавлены интеграционные тесты с использованием testcontainers.

## Описание веб-приложения

Фронт-приложение на Vue.js, предоставляющее веб-интерфейс пользователю, дано [как-есть](./frontend).

Для его работы требуется nodejs версии от 19.7.0.

Следуя [описанию](./frontend/README.md), оно запускается командами `npm install`, `npm run serve` в его рабочей директории.

Корневой URL для вызова тылового сервиса прописывается в файле [`.env`](./frontend/.env).
        
По умолчанию приложение запускается на порту 8080 и доступен в браузере как `http://localhost:8080`. Если порт 8080 занят, FRONT займёт следующий доступный (`8081`). После выполнения `npm run serve` в терминале вы увидите, на каком порту он запустился.

## Авторизация приложения

FRONT-приложение использует header `auth-token`, в котором отправляет токен (ключ-строка) для идентификации пользователя на BACKEND.
Для получения токена нужно пройти авторизацию на BACKEND и отправить на метод /login логин и пароль. В случае успешной проверки в ответ BACKEND должен вернуть json-объект
с полем `auth-token` и значением токена. Все дальейшие запросы с FRONTEND, кроме метода /login, отправляются с этим header.
Для выхода из приложения нужно вызвать метод BACKEND /logout, который удалит/деактивирует токен. Последующие запросы с этим токеном будут не авторизованы и вернут код 401.

Обратите внимание, что название самого параметра (как и всех параметров в спецификации), его регистр имеют значение.
Важно, чтобы ваш backend возвращал токен в поле `auth-token` – если поле будет называться `authToken` или `authtoken`, фронт не сможет найти токен и дальше логина процесс не пройдёт.

## Настройка CORS

Чтобы FRONT смог обратиться к вашему серверу, необходимо настроить CORS в вашем приложении. Например, можно сделать это, добавив конфигурацию:
```java
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
@EnableWebMvc
class WebConfig implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
            .allowCredentials(true)
            .allowedOrigins("http://localhost:8081")
            .allowedMethods("*");
    }
}
```
где адрес в параметре `allowedOrigins` – это адрес фронта.

## Дополнительные рекомендации

Это итоговый проект, где вы будете использовать все полученные вами знания не только в написании кода, но и в поиске информации, в траблшутинге и т.д.
Используйте все доступные вам инструменты, чтобы решить возникающие проблемы:
1) Используйте консоль разработчика в браузере, вкладка Network. Она позволит вам увидеть, какой запрос отправляет фронт, какие параметры и url он использует, какой ответ он получает.
2) Используйте дебаг в IDEA, чтобы увидеть весь процесс обработки запроса вашим приложением.
3) Используйте интернет для поиска стандартных подходов, гайдов, распространённых ошибок. Все проблемы уже были решены до нас.
____________


### Если возникли вопросы

- Попробуйте найти ответ в лекциях, материалах и домашних заданиях курса. После этого воспользуйтесь Google. В случае любой сложности вы можете задать вопрос дипломному руководителю. Но лучше сначала попытаться решить проблему самостоятельно.
- В одном вопросе лучше описывать одну проблему. Так ответ дипломного руководителя будет максимально эффективным и полезным.
- По возможности прикрепляйте к вопросу скриншоты и стрелочкой показывайте, где не получается. Программу для этого можно скачать [здесь](https://app.prntscr.com/ru/).
- По возможности задавайте вопросы в комментариях к коду.
- Начинайте работу над дипломом как можно раньше, чтобы было больше времени на правки.
- Делайте диплом по частям, а не всё сразу. Так вы сможете оперативно внести правки, и не придётся переделывать большую часть работы. 
